<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>学术论文搜索</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="style.css" rel="stylesheet">
</head>

<body>
<div class="bg-image">
<div class="container">
    <h1>LOGO的位置</h1>
    <div class="input-group mb-3" style="width: 1000px; height: 75px; margin-top: 175px; margin-left: 163px;">
        <button class="btn btn-outline-secondary dropdown-toggle bg-warning-subtle" style="width: 150px;" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="dropdown-button">按标题</button>
        <ul class="dropdown-menu bg-warning-subtle">
            <li><a class="dropdown-item" href="#" onclick="changeButtonText(this.innerText), setSearchField('author')">按作者</a></li>
            <li><a class="dropdown-item" href="#" onclick="changeButtonText(this.innerText), setSearchField('date')">按日期</a></li>
            <li><a class="dropdown-item" href="#" onclick="changeButtonText(this.innerText), setSearchField('text')">按全文</a></li>
            <li><a class="dropdown-item" href="#" onclick="changeButtonText(this.innerText), setSearchField('keywords')">按关键词</a></li>
        </ul>
        <input type="text" class="form-control" placeholder="输入关键词" id="searchQuery">
        <button class="btn btn-primary ml-3 px-5" type="button" onclick="performSearch()">搜索</button>
    </div>
</div>
<div id="results"></div>
</div>
</div>
<script>
    let selectedField = 'title'; // 默认搜索字段

    function changeMode(button) {
        document.querySelectorAll('.btn-group .btn').forEach(btn => {
            btn.classList.remove('active', 'btn-primary');
            btn.classList.add('btn-secondary');
        });


        button.classList.remove('btn-secondary');
        button.classList.add('active', 'btn-primary');
    }

    function changeButtonText(text) {
            document.getElementById('dropdown-button').innerText = text;
        }


    function setSearchField(field) {
        selectedField = field;
    }

    function performSearch() {
        const query = document.getElementById('searchQuery').value;
        fetch(`http://localhost:8080/search?query=${query}&field=${selectedField}`)
            .then(response => response.json())  
            .then(data => {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                data.forEach((item, index) => {
                    const uuid = item.uuid;
                    if (item !== null) {
                        resultsDiv.innerHTML += `
    <div class="card mb-2" style="width:900px; margin-left:410px; background-color:#EEE8AA">
        <div class="card-body">
                <p style="color:#87CEFA; font-size:25px;font-family: Sans-serif;"><b>${item.title}</b></p>
                <p><b style="font-size 17px">Author: <div style="color: #F5FFFA">${item.author}</div></b></p>
                <p class="card-text abstract" id="abstract-${index}" style="max-height: 4.5em; overflow: hidden;">
                    ${item.highlightText ? item.highlightText : '未检索到关键词'}
                </p>
                <a href="#" onClick= "getPDFByUUID('${uuid}')">[View PDF]</a>                
            </div>
        </div>
    </div>`;
                    }
                });
            });
        document.getElementById("searchQuery").value = '';
    }
    


    function getPDFByUUID(uuid) {
        event.preventDefault();
        fetch(`http://localhost:8080/pdf/${uuid}`)
            .then(response => {
                if(!response.ok){
                    throw new Error('文件未找到');
                }
                    return response.blob();
    })
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        window.open(url, '_blank')
    })
    .catch(error => {
        console.error('错误:',error);
        alert(error.message);
    })
}


    document.addEventListener('DOMContentLoaded',() => {
        const searchQuery = document.getElementById('searchQuery');

        searchQuery.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            performSearch();
        }
    });
    })

    
</script>
</body>

</html>